<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>RIALO ESCAPE — Final Move Fix</title>
<style>
html,body{
  height:100%;
  margin:0;
  background:#000;
  color:#00ffff;
  font-family:monospace;
  overflow:hidden;
  touch-action:none;
  user-select:none;
}
#game-container{width:100%;height:100vh;overflow:hidden;position:relative;}
.control-btn{
  position:absolute;
  bottom:20px;
  width:80px;height:80px;
  background:rgba(0,255,255,0.15);
  border:2px solid rgba(0,255,255,0.4);
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:30px;color:#00ffff;
  z-index:1000;
  transition:background 0.15s,transform 0.1s;
}
.control-btn:active{
  background:rgba(0,255,255,0.35);
  transform:scale(0.95);
}
#btn-left{left:20px;}
#btn-right{right:20px;}
</style>
<script src="https://unpkg.com/phaser@3.70.0/dist/phaser.js"></script>
</head>
<body>
<div id="game-container"></div>
<div id="btn-left" class="control-btn">◀</div>
<div id="btn-right" class="control-btn">▶</div>

<script>
let moveDir = 0;

function startGame(){
  const WIDTH = window.innerWidth;
  const HEIGHT = window.innerHeight;
  const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    width: WIDTH,
    height: HEIGHT,
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
    backgroundColor: '#000000',
    physics: { default: 'arcade', arcade: { gravity: { y: 0 }, debug: false } },
    scene: { preload, create, update }
  };
  const game = new Phaser.Game(config);
  let player, logos;

  function preload(){
    this.load.image('bg', 'assets/bg.png');
    this.load.image('player', 'assets/player.png');
    this.load.image('logo', 'assets/logo.png');
  }

  function create(){
    const scene = this;
    scene.add.image(WIDTH/2, HEIGHT/2, 'bg').setDisplaySize(WIDTH, HEIGHT);

    player = scene.physics.add.sprite(WIDTH/2, HEIGHT*0.85, 'player');
    player.setCollideWorldBounds(true);
    player.setDisplaySize(WIDTH * 0.3, WIDTH * 0.3);
    player.body.setAllowGravity(false);

    // Simple movement event (touch)
    const btnLeft = document.getElementById('btn-left');
    const btnRight = document.getElementById('btn-right');

    const startMove = dir => moveDir = dir;
    const stopMove = () => moveDir = 0;

    ['touchstart','mousedown'].forEach(e=>{
      btnLeft.addEventListener(e,()=>startMove(-1));
      btnRight.addEventListener(e,()=>startMove(1));
    });
    ['touchend','mouseup','touchcancel'].forEach(e=>{
      btnLeft.addEventListener(e,stopMove);
      btnRight.addEventListener(e,stopMove);
    });

    // Keyboard
    scene.input.keyboard.on('keydown-LEFT',()=>moveDir=-1);
    scene.input.keyboard.on('keydown-RIGHT',()=>moveDir=1);
    scene.input.keyboard.on('keyup-LEFT',stopMove);
    scene.input.keyboard.on('keyup-RIGHT',stopMove);

    // Group of falling logos
    logos = scene.physics.add.group();
    scene.time.addEvent({
      delay: 1000,
      callback: () => {
        const x = Phaser.Math.Between(50, WIDTH - 50);
        const logo = logos.create(x, -50, 'logo');
        logo.setVelocityY(200);
        logo.setScale(Phaser.Math.FloatBetween(0.08, 0.15));
      },
      loop: true
    });

    // Collision effect (just remove)
    scene.physics.add.overlap(player, logos, (pl, logo)=>{
      logo.destroy();
    });
  }

  function update(){
    if (!player) return;
    const speed = 300;
    player.setVelocityX(moveDir * speed);
  }
}

window.onload = startGame;
</script>
</body>
</html>  z-index:2000;
  transition:background 0.15s,transform 0.1s;
}
.control-btn:active{
  background:rgba(0,255,255,0.35);
  transform:scale(0.95);
}
#btn-left{left:20px;}
#btn-right{right:20px;}
</style>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
</head>
<body>
<div id="boot-screen">
  <img id="boot-logo" src="assets/logo.png" alt="RIALO Logo">
  <div id="boot-text">RIALO SYSTEM v3.1<br><span class="small">BOOTING... YUURA [ONLINE]</span></div>
</div>
<div id="game-container"></div>
<div id="btn-left" class="control-btn">◀</div>
<div id="btn-right" class="control-btn">▶</div>

<script>
const bootSound = new Audio('assets/sound/boot-startup.mp3');
bootSound.volume = 0.6; bootSound.play().catch(()=>{});
const bootTextEl = document.getElementById('boot-text');
let dots=0;
const bootInterval=setInterval(()=>{dots=(dots+1)%4;
  bootTextEl.innerHTML='RIALO SYSTEM v3.1<br><span class="small">BOOTING'+'.'.repeat(dots)+'</span>';
},360);
setTimeout(()=>{
  clearInterval(bootInterval);
  const bs=document.getElementById('boot-screen');
  bs.style.opacity=0;
  setTimeout(()=>{bs.style.display='none';startGame();},800);
},2400);

function startGame(){
  const WIDTH=window.innerWidth;
  const HEIGHT=window.innerHeight;
  const config={
    type:Phaser.AUTO,parent:'game-container',width:WIDTH,height:HEIGHT,
    scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},
    backgroundColor:'#000',
    physics:{default:'arcade',arcade:{gravity:{y:0},debug:false}},
    scene:{preload,create,update}
  };
  const game=new Phaser.Game(config);
  let player,logos,scoreText,criticalText,bgTile;
  let moveDir=0,score=0,combo=0,overdrive=false;

  function preload(){
    this.load.image('bg','assets/bg.png');
    this.load.image('logo','assets/logo.png');
    this.load.image('player','assets/player.png');
    this.load.audio('music','assets/sound/Chiptronical.ogg');
    this.load.audio('slash','assets/sound/energy-slash.wav');
    this.load.audio('crash','assets/sound/car-crash-into-wall-heavy-smartsound-fx-1-00-06.mp3');
    this.load.audio('overdrive','assets/sound/overdrive.wav');
  }

  function create(){
    const scene=this;
    bgTile=scene.add.tileSprite(0,0,config.width,config.height,'bg').setOrigin(0).setDepth(0);

    // Player
    player=scene.physics.add.sprite(config.width/2,config.height*0.85,'player');
    player.setDepth(6);
    player.setDisplaySize(config.width*0.3,config.width*0.3);
    player.setCollideWorldBounds(true);
    player.body.setAllowGravity(false);
    player.setVelocityX(0);

    // Groups
    logos=scene.physics.add.group();
    scene.time.addEvent({delay:900,callback:()=>spawnLogo(scene),loop:true});

    // Sounds
    const slashSound=scene.sound.add('slash',{volume:0.9});
    const crashSound=scene.sound.add('crash',{volume:0.7});
    const overdriveSound=scene.sound.add('overdrive',{volume:0.8,loop:true});
    const bgMusic=scene.sound.add('music',{volume:0.4,loop:true});
    bgMusic.play().catch(()=>{});

    // Particles
    const cutParticles=scene.add.particles('logo');
    const emitter=cutParticles.createEmitter({
      lifespan:{min:200,max:400},speed:{min:200,max:400},
      scale:{start:0.3,end:0},gravityY:400,blendMode:'ADD',quantity:10,on:false
    });

    scoreText=scene.add.text(14,14,'SCORE: 0',{fontSize:20,fill:'#00ffff'}).setDepth(10);
    criticalText=scene.add.text(config.width/2,config.height/2,'CRITICAL HIT!',
      {fontSize:40,fill:'#ff0066',fontStyle:'bold'}).setOrigin(0.5).setAlpha(0).setDepth(20);

    // Touch Controls
    const startMove=(d)=>{moveDir=d;};
    const stopMove=()=>{moveDir=0;};
    ['touchstart','mousedown'].forEach(e=>{
      document.getElementById('btn-left').addEventListener(e,()=>startMove(-1));
      document.getElementById('btn-right').addEventListener(e,()=>startMove(1));
    });
    ['touchend','mouseup','mouseleave','touchcancel'].forEach(e=>{
      document.getElementById('btn-left').addEventListener(e,stopMove);
      document.getElementById('btn-right').addEventListener(e,stopMove);
    });

    // Keyboard Controls
    scene.input.keyboard.on('keydown-LEFT',()=>moveDir=-1);
    scene.input.keyboard.on('keydown-RIGHT',()=>moveDir=1);
    scene.input.keyboard.on('keyup-LEFT',stopMove);
    scene.input.keyboard.on('keyup-RIGHT',stopMove);

    // Collider
    scene.physics.add.overlap(player,logos,(pl,logo)=>{
      if(!logo.active)return;
      emitter.emitParticleAt(logo.x,logo.y);
      slashSound.play().catch(()=>{});
      crashSound.play({volume:0.5}).catch(()=>{});
      let gain=Phaser.Math.Between(20,35);
      const isCrit=Phaser.Math.Between(1,8)===1;
      if(isCrit){gain*=2;showCritical(scene,criticalText);}
      score+=gain;combo++;
      scoreText.setText(`SCORE: ${score}  (+${gain})${combo>1?'  COMBO x'+combo:''}`);
      if(!overdrive&&combo>=15){activateOverdrive(scene,overdriveSound);}
      logo.destroy();
    });
  }

  function update(){
    bgTile.tilePositionY -= overdrive ? 2 : 1;
    if(player && player.body){
      const speed = 400;
      player.setVelocityX(moveDir * speed);
    }
  }

  function spawnLogo(scene){
    const x=Phaser.Math.Between(60,scene.scale.width-60);
    const l=logos.create(x,-60,'logo');
    l.setVelocityY(Phaser.Math.Between(240,380));
    l.setScale(Phaser.Math.FloatBetween(0.10,0.15));
    l.setDepth(4);
    l.setAngularVelocity(Phaser.Math.Between(-40,40));
    l.setTint(Phaser.Utils.Array.GetRandom([0x9f00ff,0x0099ff,0xffffff,0xff0066,0x00ffff]));
  }

  function showCritical(scene,text){
    text.setAlpha(1).setScale(1.2);
    scene.tweens.add({targets:text,alpha:{from:1,to:0},scale:{from:1.2,to:0.8},duration:600,ease:'Quad.easeOut'});
  }

  function activateOverdrive(scene,overdriveSound){
    overdrive=true; overdriveSound.play().catch(()=>{});
    scene.cameras.main.flash(100,150,40,255);
    scene.time.addEvent({delay:8000,callback:()=>{
      overdrive=false;overdriveSound.stop();
      scene.cameras.main.flash(200,0,200,255);
    }});
  }
}
</script>
</body>
</html>
