<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>RIALO: PATTERN SLASH — CHAOS TRAIL MODE ⚡</title>
  <style>
    html,body{height:100%;margin:0;background:#000;color:#00ffff;font-family:monospace}
    #game-container{width:100%;height:100vh;overflow:hidden;touch-action:none;position:relative}
    #boot-screen{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#000;z-index:1000}
    #boot-logo{width:160px;margin-bottom:12px}
    #boot-text{color:#9af;letter-spacing:1px;text-align:center}
    .small{font-size:12px;color:#99f}
    @keyframes soft-glitch{0%,100%{filter:none}50%{filter:contrast(150%) hue-rotate(10deg) saturate(120%)}}
    .glitch{animation:soft-glitch .35s linear}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
</head>
<body>
  <div id="boot-screen">
    <img id="boot-logo" src="assets/logo.png" alt="RIALO Logo">
    <div id="boot-text">RIALO SYSTEM v1.07<br><span class="small">BOOTING... YUURA [ONLINE]</span></div>
  </div>
  <div id="game-container"></div>

<script>
const bootSound = new Audio('assets/sound/boot-startup.mp3');
bootSound.volume = 0.6;
bootSound.play().catch(()=>{});

const bootTextEl = document.getElementById('boot-text');
let dots = 0;
const bootInterval = setInterval(()=>{
  dots = (dots+1)%4;
  bootTextEl.innerHTML = 'RIALO SYSTEM v1.07<br><span class="small">BOOTING' + '.'.repeat(dots) + '</span>';
}, 360);

setTimeout(()=>{
  clearInterval(bootInterval);
  const bs = document.getElementById('boot-screen');
  bs.style.opacity = 0;
  setTimeout(()=>{ bs.style.display = 'none'; startGame(); }, 900);
}, 2600);

function startGame(){
  const WIDTH = window.innerWidth;
  const HEIGHT = window.innerHeight;

  const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    width: WIDTH,
    height: HEIGHT,
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
    backgroundColor: '#000000',
    physics: { default: 'arcade', arcade: { debug: false } },
    scene: { preload, create, update }
  };

  const game = new Phaser.Game(config);
  let player, logos, logoTimer, bgTile, swordZone, sword;
  let score = 0, combo = 0;
  let scoreText;
  let bgMusic, slashSound, impactSound, overdriveSound;
  let overdrive = false;
  let touchStartX = 0;

  function preload(){
    this.load.image('bg', 'assets/bg.png');
    this.load.image('logo', 'assets/logo.png');
    this.load.image('player', 'assets/player.png');
    this.load.image('sword', 'assets/sword.png');
    this.load.audio('boot', 'assets/sound/boot-startup.mp3');
    this.load.audio('music', 'assets/sound/Chiptronical.ogg');
    this.load.audio('crash', 'assets/sound/car-crash-into-wall-heavy-smartsound-fx-1-00-06.mp3');
    this.load.audio('slash', 'assets/sound/energy-slash.wav');
    this.load.audio('overdrive', 'assets/sound/overdrive.wav');
  }

  function create(){
    const scene = this;
    bgTile = scene.add.tileSprite(0,0,config.width,config.height,'bg').setOrigin(0).setDepth(0);
    bgTile.setScale(Math.max(config.width/800, config.height/600));

    player = scene.physics.add.sprite(config.width/2, config.height - 120, 'player');
    player.setImmovable(true).setDepth(6);
    player.displayWidth = Math.min(220, config.width * 0.36);
    player.scaleY = player.scaleX;
    player.setCollideWorldBounds(true);

    sword = scene.add.image(player.x + 12, player.y - 40, 'sword').setDepth(7);
    sword.setScale(Math.min(0.6, config.width/1400));
    sword.setTint(0x9f00ff).setAlpha(0.9);

    swordZone = scene.add.zone(player.x, player.y - 10, player.displayWidth * 1.25, 64).setOrigin(0.5);
    scene.physics.add.existing(swordZone, false);
    swordZone.body.allowGravity = false;
    swordZone.body.setImmovable(true);

    logos = scene.physics.add.group();
    logoTimer = scene.time.addEvent({ delay: 900, callback: spawnLogo, callbackScope: scene, loop: true });

    bgMusic = scene.sound.add('music', { loop:true, volume:0.45 });
    slashSound = scene.sound.add('slash', { volume:0.95 });
    impactSound = scene.sound.add('crash', { volume:0.9 });
    overdriveSound = scene.sound.add('overdrive', { volume:0.9, loop:true });
    bgMusic.play().catch(()=>{});

    scoreText = scene.add.text(14,14,'SCORE: 0',{fontFamily:'monospace',fontSize:20,fill:'#00ffff'}).setDepth(10);

    scene.input.on('pointerdown', p=>{ touchStartX = p.x; });
    scene.input.on('pointerup', p=>{ handleSwipe(p.x - touchStartX); });
    scene.input.keyboard.on('keydown-LEFT', ()=> movePlayer(-1));
    scene.input.keyboard.on('keydown-RIGHT', ()=> movePlayer(1));

    scene.physics.add.overlap(swordZone, logos, (zone, logo)=>{
      if(!logo.active) return;
      slashSound.play().catch(()=>{});
      impactSound.play({volume:0.35}).catch(()=>{});
      score += 10; combo++;
      scoreText.setText('SCORE: '+score+(combo>1?'  COMBO x'+combo:''));
      if(!overdrive && combo >= 10){ activateOverdrive(scene); }
      logo.destroy();
    }, null, scene);
  }

  function update(){
    bgTile.tilePositionY -= 0.5;
  }

  function spawnLogo(){
    const scene = this.scene;
    const x = Phaser.Math.Between(60, config.width - 60);
    const l = logos.create(x, -60, 'logo');
    l.setVelocityY(Phaser.Math.Between(overdrive?400:220, overdrive?560:360));
    l.setDepth(4);
    l.setScale(Math.min(0.72, config.width/900));
    l.body.setAllowGravity(false);
  }

  function movePlayer(dir){
    const step=Math.max(64,config.width*0.18);
    const newX=Phaser.Math.Clamp(player.x+dir*step,80,config.width-80);
    player.x=newX;
  }

  function handleSwipe(dx){
    if(Math.abs(dx)<30)return;
    movePlayer(dx>0?1:-1);
  }

  function activateOverdrive(scene){
    overdrive=true;
    scene.cameras.main.setBackgroundColor(0x130014);
    overdriveSound.play().catch(()=>{});
    logoTimer.remove(false);
    logoTimer=scene.time.addEvent({delay:600,callback:spawnLogo,callbackScope:scene,loop:true});
  }
}
</script>
</body>
</html>
