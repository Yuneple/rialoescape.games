<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>RIALO: Pattern Slash — FINAL ⚡</title>
  <style>
    html,body{
      height:100%;
      margin:0;
      background:#000;
      color:#00ffff;
      font-family:monospace;
      overflow:hidden;
      touch-action:manipulation;
    }
    #game-container{
      width:100%;
      height:100vh;
      overflow:hidden;
      position:relative;
    }
    #boot-screen{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      background:#000;
      z-index:1000;
      transition:opacity .8s;
    }
    #boot-logo{
      width:160px;
      margin-bottom:10px;
      filter:drop-shadow(0 0 10px #00ffff);
    }
    #boot-text{color:#9af;text-align:center;font-size:14px}
    .small{font-size:12px;color:#99f}
    @keyframes auraPulse {
      0%,100%{filter:brightness(1)}
      50%{filter:brightness(1.4) hue-rotate(20deg)}
    }
    .aura {animation:auraPulse 1.2s infinite}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
</head>
<body>
  <div id="boot-screen">
    <img id="boot-logo" src="assets/logo.png" alt="RIALO Logo">
    <div id="boot-text">RIALO SYSTEM v1.9<br><span class="small">BOOTING... YUURA [ONLINE]</span></div>
  </div>
  <div id="game-container"></div>

<script>
const bootSound = new Audio('assets/sound/boot-startup.mp3');
bootSound.volume = 0.6;
bootSound.play().catch(()=>{});

const bootTextEl = document.getElementById('boot-text');
let dots = 0;
const bootInterval = setInterval(()=>{
  dots = (dots+1)%4;
  bootTextEl.innerHTML = 'RIALO SYSTEM v1.9<br><span class="small">BOOTING' + '.'.repeat(dots) + '</span>';
}, 360);

setTimeout(()=>{
  clearInterval(bootInterval);
  const bs = document.getElementById('boot-screen');
  bs.style.opacity = 0;
  setTimeout(()=>{ bs.style.display = 'none'; startGame(); }, 800);
}, 2200);

function startGame(){
  const WIDTH = window.innerWidth;
  const HEIGHT = window.innerHeight;

  const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    width: WIDTH,
    height: HEIGHT,
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
    backgroundColor: '#000000',
    physics: { default: 'arcade', arcade: { debug: false } },
    scene: { preload, create, update }
  };

  const game = new Phaser.Game(config);
  let player, logos, logoTimer, bgTile, scene;
  let score = 0, combo = 0;
  let scoreText;
  let bgMusic, slashSound, impactSound, overdriveSound;
  let overdrive = false;

  function preload(){
    this.load.image('bg', 'assets/bg.png');
    this.load.image('logo', 'assets/logo.png');
    this.load.image('player', 'assets/player.png');
    this.load.audio('music', 'assets/sound/Chiptronical.ogg');
    this.load.audio('slash', 'assets/sound/energy-slash.wav');
    this.load.audio('crash', 'assets/sound/car-crash-into-wall-heavy-smartsound-fx-1-00-06.mp3');
    this.load.audio('overdrive', 'assets/sound/overdrive.wav');
  }

  function create(){
    scene = this;
    bgTile = scene.add.tileSprite(0,0,config.width,config.height,'bg').setOrigin(0).setDepth(0);

    // === Player (center bottom)
    player = scene.physics.add.sprite(config.width/2, config.height * 0.85, 'player');
    player.setDepth(6);
    player.displayWidth = config.width * 0.3;
    player.scaleY = player.scaleX;
    player.setCollideWorldBounds(true);

    // === Logo Group
    logos = scene.physics.add.group();
    logoTimer = scene.time.addEvent({ delay: 850, callback: spawnLogo, callbackScope: scene, loop: true });

    // === Sounds
    bgMusic = scene.sound.add('music', { loop:true, volume:0.45 });
    slashSound = scene.sound.add('slash', { volume:0.95 });
    impactSound = scene.sound.add('crash', { volume:0.9 });
    overdriveSound = scene.sound.add('overdrive', { volume:0.7, loop:true });
    bgMusic.play().catch(()=>{});

    // === Score Text
    scoreText = scene.add.text(14,14,'SCORE: 0',{fontFamily:'monospace',fontSize:20,fill:'#00ffff'}).setDepth(10);

    // === Input (Real drag)
    let dragging = false;
    scene.input.on('pointerdown', ()=>{ dragging = true; });
    scene.input.on('pointerup', ()=>{ dragging = false; });
    scene.input.on('pointermove', (p)=>{
      if(dragging){
        player.x = Phaser.Math.Clamp(p.x, player.displayWidth/2, config.width - player.displayWidth/2);
      }
    });

    // === Keyboard Control
    scene.input.keyboard.on('keydown-LEFT', ()=> movePlayer(-1));
    scene.input.keyboard.on('keydown-RIGHT', ()=> movePlayer(1));

    // === Collider
    scene.physics.add.overlap(player, logos, (pl, logo)=>{
      if(!logo.active) return;
      slashSound.play().catch(()=>{});
      impactSound.play({volume:0.3}).catch(()=>{});
      scene.cameras.main.shake(40, 0.0025);
      score += 10; combo++;
      scoreText.setText('SCORE: '+score+(combo>1?'  COMBO x'+combo:''));
      if(!overdrive && combo >= 15){ activateOverdrive(scene); }
      logo.destroy();
    }, null, scene);
  }

  function update(){
    bgTile.tilePositionY -= overdrive ? 2.2 : 0.8;
  }

  function movePlayer(dir){
    const step = config.width * 0.08;
    const newX = Phaser.Math.Clamp(player.x + dir * step, player.displayWidth/2, config.width - player.displayWidth/2);
    player.x = newX;
  }

  function spawnLogo(){
    const x = Phaser.Math.Between(60, config.width - 60);
    const l = logos.create(x, -60, 'logo');
    const speed = Phaser.Math.Between(260, 400);
    const scale = Phaser.Math.FloatBetween(0.08, 0.15);
    const tintColors = [0x9f00ff, 0x0099ff, 0xffffff, 0xff0066, 0x00ffff];
    l.setVelocityY(speed);
    l.setDepth(4);
    l.setScale(scale);
    l.setAngularVelocity(Phaser.Math.Between(-50, 50));
    l.setTint(Phaser.Utils.Array.GetRandom(tintColors));
  }

  function activateOverdrive(scene){
    overdrive = true;
    scene.cameras.main.flash(100,150,40,255);
    scene.cameras.main.setBackgroundColor(0x150015);
    overdriveSound.play().catch(()=>{});
    logoTimer.remove(false);
    logoTimer = scene.time.addEvent({ delay: 600, callback: spawnLogo, callbackScope: scene, loop: true });

    // Aura visual effect
    document.body.classList.add('aura');
    scene.time.addEvent({
      delay: 10000, // 10 detik durasi overdrive
      callback: ()=>{
        overdrive = false;
        document.body.classList.remove('aura');
        overdriveSound.stop();
        scene.cameras.main.setBackgroundColor('#000000');
      }
    });
  }
}
</script>
</body>
</html>