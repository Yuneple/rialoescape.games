<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>RIALO: Pattern Slash â€” v2.6 ðŸš€ Movement Fixed</title>
<style>
html,body{
  height:100%;
  margin:0;
  background:#000;
  color:#00ffff;
  font-family:monospace;
  overflow:hidden;
  touch-action:none;
  user-select:none;
}
#game-container{width:100%;height:100vh;overflow:hidden;position:relative;}
#boot-screen{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  flex-direction:column;background:#000;z-index:1000;transition:opacity .8s;
}
#boot-logo{width:160px;margin-bottom:10px;filter:drop-shadow(0 0 10px #00ffff);}
#boot-text{color:#9af;text-align:center;font-size:14px}
.small{font-size:12px;color:#99f}
@keyframes auraPulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.4) hue-rotate(20deg)}}
.aura{animation:auraPulse 1.2s infinite}

/* Mobile Controls */
.control-btn {
  position:absolute;
  bottom:20px;
  width:80px;height:80px;
  background:rgba(0,255,255,0.15);
  border:2px solid rgba(0,255,255,0.4);
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:30px;color:#00ffff;
  z-index:2000;
  transition:background 0.15s, transform 0.1s;
}
.control-btn:active {
  background:rgba(0,255,255,0.35);
  transform:scale(0.95);
}
#btn-left{left:20px;}
#btn-right{right:20px;}
</style>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
</head>
<body>
<div id="boot-screen">
  <img id="boot-logo" src="assets/logo.png" alt="RIALO Logo">
  <div id="boot-text">RIALO SYSTEM v2.6<br><span class="small">BOOTING... YUURA [ONLINE]</span></div>
</div>
<div id="game-container"></div>
<div id="btn-left" class="control-btn">â—€</div>
<div id="btn-right" class="control-btn">â–¶</div>

<script>
const bootSound = new Audio('assets/sound/boot-startup.mp3');
bootSound.volume = 0.6; bootSound.play().catch(()=>{});
const bootTextEl = document.getElementById('boot-text');
let dots=0;
const bootInterval=setInterval(()=>{dots=(dots+1)%4;
  bootTextEl.innerHTML='RIALO SYSTEM v2.6<br><span class="small">BOOTING'+'.'.repeat(dots)+'</span>';
},360);
setTimeout(()=>{
  clearInterval(bootInterval);
  const bs=document.getElementById('boot-screen');
  bs.style.opacity=0;
  setTimeout(()=>{bs.style.display='none';startGame();},800);
},2200);

function startGame(){
  const WIDTH=window.innerWidth;
  const HEIGHT=window.innerHeight;
  const config={
    type:Phaser.AUTO,parent:'game-container',width:WIDTH,height:HEIGHT,
    scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},
    backgroundColor:'#000000',
    physics:{default:'arcade',arcade:{debug:false}},
    scene:{preload,create,update}
  };
  const game=new Phaser.Game(config);
  let player,logos,logoTimer,bgTile,scene,cutEmitter;
  let score=0,combo=0;
  let scoreText,criticalText;
  let bgMusic,slashSound,crashSound,overdriveSound;
  let overdrive=false;
  let moveDir=0;

  function preload(){
    this.load.image('bg','assets/bg.png');
    this.load.image('logo','assets/logo.png');
    this.load.image('player','assets/player.png');
    this.load.audio('music','assets/sound/Chiptronical.ogg');
    this.load.audio('slash','assets/sound/energy-slash.wav');
    this.load.audio('crash','assets/sound/car-crash-into-wall-heavy-smartsound-fx-1-00-06.mp3');
    this.load.audio('overdrive','assets/sound/overdrive.wav');
  }

  function create(){
    scene=this;
    bgTile=scene.add.tileSprite(0,0,config.width,config.height,'bg').setOrigin(0).setDepth(0);

    // Player
    player=scene.physics.add.sprite(config.width/2,config.height*0.85,'player');
    player.setDepth(6);
    player.displayWidth=config.width*0.3;
    player.scaleY=player.scaleX;
    player.setCollideWorldBounds(true);

    // Groups
    logos=scene.physics.add.group();
    logoTimer=scene.time.addEvent({delay:850,callback:spawnLogo,callbackScope:scene,loop:true});

    // Sounds
    bgMusic=scene.sound.add('music',{loop:true,volume:0.45});
    slashSound=scene.sound.add('slash',{volume:0.9});
    crashSound=scene.sound.add('crash',{volume:0.9});
    overdriveSound=scene.sound.add('overdrive',{volume:0.7,loop:true});
    bgMusic.play().catch(()=>{});

    // Particles
    const cutParticles=scene.add.particles('logo');
    cutEmitter=cutParticles.createEmitter({
      lifespan:{min:200,max:400},speed:{min:200,max:400},
      scale:{start:0.4,end:0},gravityY:400,blendMode:'ADD',quantity:10,on:false
    });

    scoreText=scene.add.text(14,14,'SCORE: 0',{fontFamily:'monospace',fontSize:20,fill:'#00ffff'}).setDepth(10);
    criticalText=scene.add.text(config.width/2,config.height/2,'CRITICAL HIT!',{
      fontFamily:'monospace',fontSize:40,fill:'#ff0066',fontStyle:'bold'
    }).setOrigin(0.5).setAlpha(0).setDepth(15);

    // === MOBILE CONTROLS ===
    const btnLeft=document.getElementById('btn-left');
    const btnRight=document.getElementById('btn-right');

    const startMove=(dir)=>{ moveDir=dir; };
    const stopMove=()=>{ moveDir=0; };

    // --- Actual reliable listeners ---
    ['mousedown','touchstart','pointerdown'].forEach(ev=>{
      btnLeft.addEventListener(ev,()=>startMove(-1));
      btnRight.addEventListener(ev,()=>startMove(1));
    });
    ['mouseup','touchend','touchcancel','pointerup','pointercancel'].forEach(ev=>{
      btnLeft.addEventListener(ev,stopMove);
      btnRight.addEventListener(ev,stopMove);
    });

    // === Keyboard ===
    scene.input.keyboard.on('keydown-LEFT',()=>moveDir=-1);
    scene.input.keyboard.on('keydown-RIGHT',()=>moveDir=1);
    scene.input.keyboard.on('keyup-LEFT',stopMove);
    scene.input.keyboard.on('keyup-RIGHT',stopMove);

    // === Collider ===
    scene.physics.add.overlap(player,logos,(pl,logo)=>{
      if(!logo.active)return;
      cutEmitter.emitParticleAt(logo.x,logo.y);

      const vol=Phaser.Math.Between(80,100)/100;
      slashSound.play({volume:vol}).catch(()=>{});
      setTimeout(()=>crashSound.play({volume:0.6}).catch(()=>{}),60);

      const isCritical=Phaser.Math.Between(1,10)===1;
      let gain=Phaser.Math.Between(20,35);
      if(isCritical){gain*=2;showCriticalEffect();}

      scene.cameras.main.flash(isCritical?120:80,255,80,255);
      scene.cameras.main.shake(isCritical?80:50,isCritical?0.005:0.003);

      score+=gain;combo++;
      scoreText.setText(`SCORE: ${score}  (+${gain})${combo>1?'  COMBO x'+combo:''}`);
      if(!overdrive&&combo>=15){activateOverdrive(scene);}
      logo.destroy();
    });
  }

  function update(){
    bgTile.tilePositionY-=overdrive?2.2:0.8;
    if(moveDir!==0){
      const step=config.width*0.025*(overdrive?1.5:1);
      player.x=Phaser.Math.Clamp(player.x+moveDir*step,player.displayWidth/2,config.width-player.displayWidth/2);
    }
  }

  function showCriticalEffect(){
    criticalText.setAlpha(1);
    criticalText.scale=1.2;
    scene.tweens.add({targets:criticalText,alpha:{from:1,to:0},scale:{from:1.3,to:0.8},duration:600,ease:'Quad.easeOut'});
  }

  function spawnLogo(){
    const x=Phaser.Math.Between(60,config.width-60);
    const l=logos.create(x,-60,'logo');
    const speed=Phaser.Math.Between(260,400);
    const scale=Phaser.Math.FloatBetween(0.08,0.15);
    const tintColors=[0x9f00ff,0x0099ff,0xffffff,0xff0066,0x00ffff];
    l.setVelocityY(speed);
    l.setDepth(4);
    l.setScale(scale);
    l.setAngularVelocity(Phaser.Math.Between(-50,50));
    l.setTint(Phaser.Utils.Array.GetRandom(tintColors));
  }

  function activateOverdrive(scene){
    overdrive=true;
    document.body.classList.add('aura');
    scene.cameras.main.flash(100,150,40,255);
    scene.cameras.main.setBackgroundColor(0x150015);
    overdriveSound.play().catch(()=>{});
    logoTimer.remove(false);
    logoTimer=scene.time.addEvent({delay:600,callback:spawnLogo,callbackScope:scene,loop:true});
    scene.time.addEvent({delay:10000,callback:()=>{
      overdrive=false;
      document.body.classList.remove('aura');
      overdriveSound.stop();
      scene.cameras.main.setBackgroundColor('#000');
    }});
  }
}
</script>
</body>
</html>